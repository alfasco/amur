
import{Injectable}from'../di/decorators';import{Map,MapWrapper}from'../facade/collection';import{scheduleMicroTask}from'../facade/lang';import{NgZone}from'../zone/ng_zone';export var Testability=(function(){function Testability(_ngZone){this._ngZone=_ngZone;this._pendingCount=0;this._isZoneStable=true;this._didWork=false;this._callbacks=[];this._watchAngularEvents();}
Testability.prototype._watchAngularEvents=function(){var _this=this;this._ngZone.onUnstable.subscribe({next:function(){_this._didWork=true;_this._isZoneStable=false;}});this._ngZone.runOutsideAngular(function(){_this._ngZone.onStable.subscribe({next:function(){NgZone.assertNotInAngularZone();scheduleMicroTask(function(){_this._isZoneStable=true;_this._runCallbacksIfReady();});}});});};Testability.prototype.increasePendingRequestCount=function(){this._pendingCount+=1;this._didWork=true;return this._pendingCount;};Testability.prototype.decreasePendingRequestCount=function(){this._pendingCount-=1;if(this._pendingCount<0){throw new Error('pending async requests below zero');}
this._runCallbacksIfReady();return this._pendingCount;};Testability.prototype.isStable=function(){return this._isZoneStable&&this._pendingCount==0&&!this._ngZone.hasPendingMacrotasks;};Testability.prototype._runCallbacksIfReady=function(){var _this=this;if(this.isStable()){scheduleMicroTask(function(){while(_this._callbacks.length!==0){(_this._callbacks.pop())(_this._didWork);}
_this._didWork=false;});}
else{this._didWork=true;}};Testability.prototype.whenStable=function(callback){this._callbacks.push(callback);this._runCallbacksIfReady();};Testability.prototype.getPendingRequestCount=function(){return this._pendingCount;};Testability.prototype.findBindings=function(using,provider,exactMatch){return[];};Testability.prototype.findProviders=function(using,provider,exactMatch){return[];};Testability.decorators=[{type:Injectable},];Testability.ctorParameters=[{type:NgZone,},];return Testability;}());export var TestabilityRegistry=(function(){function TestabilityRegistry(){this._applications=new Map();_testabilityGetter.addToWindow(this);}
TestabilityRegistry.prototype.registerApplication=function(token,testability){this._applications.set(token,testability);};TestabilityRegistry.prototype.getTestability=function(elem){return this._applications.get(elem);};TestabilityRegistry.prototype.getAllTestabilities=function(){return MapWrapper.values(this._applications);};TestabilityRegistry.prototype.getAllRootElements=function(){return MapWrapper.keys(this._applications);};TestabilityRegistry.prototype.findTestabilityInTree=function(elem,findInAncestors){if(findInAncestors===void 0){findInAncestors=true;}
return _testabilityGetter.findTestabilityInTree(this,elem,findInAncestors);};TestabilityRegistry.decorators=[{type:Injectable},];TestabilityRegistry.ctorParameters=[];return TestabilityRegistry;}());var _NoopGetTestability=(function(){function _NoopGetTestability(){}
_NoopGetTestability.prototype.addToWindow=function(registry){};_NoopGetTestability.prototype.findTestabilityInTree=function(registry,elem,findInAncestors){return null;};return _NoopGetTestability;}());export function setTestabilityGetter(getter){_testabilityGetter=getter;}
var _testabilityGetter=new _NoopGetTestability();