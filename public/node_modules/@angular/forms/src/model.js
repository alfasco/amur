
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};import{fromPromise}from'rxjs/observable/fromPromise';import{composeAsyncValidators,composeValidators}from'./directives/shared';import{EventEmitter}from'./facade/async';import{ListWrapper,StringMapWrapper}from'./facade/collection';import{isBlank,isPresent,isPromise,isStringMap,normalizeBool}from'./facade/lang';export var VALID='VALID';export var INVALID='INVALID';export var PENDING='PENDING';export var DISABLED='DISABLED';export function isControl(control){return control instanceof AbstractControl;}
function _find(control,path,delimiter){if(isBlank(path))
return null;if(!(path instanceof Array)){path=path.split(delimiter);}
if(path instanceof Array&&ListWrapper.isEmpty(path))
return null;return path.reduce(function(v,name){if(v instanceof FormGroup){return isPresent(v.controls[name])?v.controls[name]:null;}
else if(v instanceof FormArray){var index=name;return isPresent(v.at(index))?v.at(index):null;}
else{return null;}},control);}
function toObservable(r){return isPromise(r)?fromPromise(r):r;}
function coerceToValidator(validator){return Array.isArray(validator)?composeValidators(validator):validator;}
function coerceToAsyncValidator(asyncValidator){return Array.isArray(asyncValidator)?composeAsyncValidators(asyncValidator):asyncValidator;}
export var AbstractControl=(function(){function AbstractControl(validator,asyncValidator){this.validator=validator;this.asyncValidator=asyncValidator;this._pristine=true;this._touched=false;}
Object.defineProperty(AbstractControl.prototype,"value",{get:function(){return this._value;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"status",{get:function(){return this._status;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"valid",{get:function(){return this._status===VALID;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"invalid",{get:function(){return this._status===INVALID;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"errors",{get:function(){return this._errors;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"pristine",{get:function(){return this._pristine;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"dirty",{get:function(){return!this.pristine;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"touched",{get:function(){return this._touched;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"untouched",{get:function(){return!this._touched;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"valueChanges",{get:function(){return this._valueChanges;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"statusChanges",{get:function(){return this._statusChanges;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"pending",{get:function(){return this._status==PENDING;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"disabled",{get:function(){return this._status===DISABLED;},enumerable:true,configurable:true});Object.defineProperty(AbstractControl.prototype,"enabled",{get:function(){return this._status!==DISABLED;},enumerable:true,configurable:true});AbstractControl.prototype.setAsyncValidators=function(newValidator){this.asyncValidator=coerceToAsyncValidator(newValidator);};AbstractControl.prototype.clearAsyncValidators=function(){this.asyncValidator=null;};AbstractControl.prototype.setValidators=function(newValidator){this.validator=coerceToValidator(newValidator);};AbstractControl.prototype.clearValidators=function(){this.validator=null;};AbstractControl.prototype.markAsTouched=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;onlySelf=normalizeBool(onlySelf);this._touched=true;if(isPresent(this._parent)&&!onlySelf){this._parent.markAsTouched({onlySelf:onlySelf});}};AbstractControl.prototype.markAsDirty=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;onlySelf=normalizeBool(onlySelf);this._pristine=false;if(isPresent(this._parent)&&!onlySelf){this._parent.markAsDirty({onlySelf:onlySelf});}};AbstractControl.prototype.markAsPristine=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;this._pristine=true;this._forEachChild(function(control){control.markAsPristine({onlySelf:true});});if(isPresent(this._parent)&&!onlySelf){this._parent._updatePristine({onlySelf:onlySelf});}};AbstractControl.prototype.markAsUntouched=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;this._touched=false;this._forEachChild(function(control){control.markAsUntouched({onlySelf:true});});if(isPresent(this._parent)&&!onlySelf){this._parent._updateTouched({onlySelf:onlySelf});}};AbstractControl.prototype.markAsPending=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;onlySelf=normalizeBool(onlySelf);this._status=PENDING;if(isPresent(this._parent)&&!onlySelf){this._parent.markAsPending({onlySelf:onlySelf});}};AbstractControl.prototype.disable=function(_a){var _b=_a===void 0?{}:_a,onlySelf=_b.onlySelf,emitEvent=_b.emitEvent;emitEvent=isPresent(emitEvent)?emitEvent:true;this._status=DISABLED;this._forEachChild(function(control){control.disable({onlySelf:true});});this._updateValue();if(emitEvent){this._valueChanges.emit(this._value);this._statusChanges.emit(this._status);}
this._updateAncestors(onlySelf);this._onDisabledChange(true);};AbstractControl.prototype.enable=function(_a){var _b=_a===void 0?{}:_a,onlySelf=_b.onlySelf,emitEvent=_b.emitEvent;this._status=VALID;this._forEachChild(function(control){control.enable({onlySelf:true});});this.updateValueAndValidity({onlySelf:true,emitEvent:emitEvent});this._updateAncestors(onlySelf);this._onDisabledChange(false);};AbstractControl.prototype._updateAncestors=function(onlySelf){if(isPresent(this._parent)&&!onlySelf){this._parent.updateValueAndValidity();this._parent._updatePristine();this._parent._updateTouched();}};AbstractControl.prototype.setParent=function(parent){this._parent=parent;};AbstractControl.prototype.updateValueAndValidity=function(_a){var _b=_a===void 0?{}:_a,onlySelf=_b.onlySelf,emitEvent=_b.emitEvent;onlySelf=normalizeBool(onlySelf);emitEvent=isPresent(emitEvent)?emitEvent:true;this._updateValue();this._errors=this._runValidator();var originalStatus=this._status;this._status=this._calculateStatus();if(this._status==VALID||this._status==PENDING){this._runAsyncValidator(emitEvent);}
if(this._disabledChanged(originalStatus)){this._updateValue();}
if(emitEvent){this._valueChanges.emit(this._value);this._statusChanges.emit(this._status);}
if(isPresent(this._parent)&&!onlySelf){this._parent.updateValueAndValidity({onlySelf:onlySelf,emitEvent:emitEvent});}};AbstractControl.prototype._updateTreeValidity=function(_a){var emitEvent=(_a===void 0?{emitEvent:true}:_a).emitEvent;this._forEachChild(function(ctrl){return ctrl._updateTreeValidity({emitEvent:emitEvent});});this.updateValueAndValidity({onlySelf:true,emitEvent:emitEvent});};AbstractControl.prototype._runValidator=function(){return isPresent(this.validator)?this.validator(this):null;};AbstractControl.prototype._runAsyncValidator=function(emitEvent){var _this=this;if(isPresent(this.asyncValidator)){this._status=PENDING;this._cancelExistingSubscription();var obs=toObservable(this.asyncValidator(this));this._asyncValidationSubscription=obs.subscribe({next:function(res){return _this.setErrors(res,{emitEvent:emitEvent});}});}};AbstractControl.prototype._cancelExistingSubscription=function(){if(isPresent(this._asyncValidationSubscription)){this._asyncValidationSubscription.unsubscribe();}};AbstractControl.prototype._disabledChanged=function(originalStatus){return this._status!==originalStatus&&(this._status===DISABLED||originalStatus===DISABLED);};AbstractControl.prototype.setErrors=function(errors,_a){var emitEvent=(_a===void 0?{}:_a).emitEvent;emitEvent=isPresent(emitEvent)?emitEvent:true;this._errors=errors;this._updateControlsErrors(emitEvent);};AbstractControl.prototype.get=function(path){return _find(this,path,'.');};AbstractControl.prototype.getError=function(errorCode,path){if(path===void 0){path=null;}
var control=isPresent(path)&&!ListWrapper.isEmpty(path)?this.get(path):this;if(isPresent(control)&&isPresent(control._errors)){return StringMapWrapper.get(control._errors,errorCode);}
else{return null;}};AbstractControl.prototype.hasError=function(errorCode,path){if(path===void 0){path=null;}
return isPresent(this.getError(errorCode,path));};Object.defineProperty(AbstractControl.prototype,"root",{get:function(){var x=this;while(isPresent(x._parent)){x=x._parent;}
return x;},enumerable:true,configurable:true});AbstractControl.prototype._updateControlsErrors=function(emitEvent){this._status=this._calculateStatus();if(emitEvent){this._statusChanges.emit(this._status);}
if(isPresent(this._parent)){this._parent._updateControlsErrors(emitEvent);}};AbstractControl.prototype._initObservables=function(){this._valueChanges=new EventEmitter();this._statusChanges=new EventEmitter();};AbstractControl.prototype._calculateStatus=function(){if(isPresent(this._errors))
return INVALID;if(this._anyControlsHaveStatus(PENDING))
return PENDING;if(this._anyControlsHaveStatus(INVALID))
return INVALID;if(this._allControlsDisabled())
return DISABLED;return VALID;};AbstractControl.prototype._anyControlsHaveStatus=function(status){return this._anyControls(function(control){return control.status==status;});};AbstractControl.prototype._anyControlsDirty=function(){return this._anyControls(function(control){return control.dirty;});};AbstractControl.prototype._anyControlsTouched=function(){return this._anyControls(function(control){return control.touched;});};AbstractControl.prototype._updatePristine=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;this._pristine=!this._anyControlsDirty();if(isPresent(this._parent)&&!onlySelf){this._parent._updatePristine({onlySelf:onlySelf});}};AbstractControl.prototype._updateTouched=function(_a){var onlySelf=(_a===void 0?{}:_a).onlySelf;this._touched=this._anyControlsTouched();if(isPresent(this._parent)&&!onlySelf){this._parent._updateTouched({onlySelf:onlySelf});}};AbstractControl.prototype._onDisabledChange=function(isDisabled){};AbstractControl.prototype._isBoxedValue=function(formState){return isStringMap(formState)&&Object.keys(formState).length===2&&'value'in formState&&'disabled'in formState;};return AbstractControl;}());export var FormControl=(function(_super){__extends(FormControl,_super);function FormControl(formState,validator,asyncValidator){if(formState===void 0){formState=null;}
if(validator===void 0){validator=null;}
if(asyncValidator===void 0){asyncValidator=null;}
_super.call(this,coerceToValidator(validator),coerceToAsyncValidator(asyncValidator));this._onChange=[];this._applyFormState(formState);this.updateValueAndValidity({onlySelf:true,emitEvent:false});this._initObservables();}
FormControl.prototype.setValue=function(value,_a){var _this=this;var _b=_a===void 0?{}:_a,onlySelf=_b.onlySelf,emitEvent=_b.emitEvent,emitModelToViewChange=_b.emitModelToViewChange,emitViewToModelChange=_b.emitViewToModelChange;emitModelToViewChange=isPresent(emitModelToViewChange)?emitModelToViewChange:true;emitViewToModelChange=isPresent(emitViewToModelChange)?emitViewToModelChange:true;this._value=value;if(this._onChange.length&&emitModelToViewChange){this._onChange.forEach(function(changeFn){return changeFn(_this._value,emitViewToModelChange);});}
this.updateValueAndValidity({onlySelf:onlySelf,emitEvent:emitEvent});};FormControl.prototype.patchValue=function(value,options){if(options===void 0){options={};}
this.setValue(value,options);};FormControl.prototype.reset=function(formState,_a){if(formState===void 0){formState=null;}
var onlySelf=(_a===void 0?{}:_a).onlySelf;this._applyFormState(formState);this.markAsPristine({onlySelf:onlySelf});this.markAsUntouched({onlySelf:onlySelf});this.setValue(this._value,{onlySelf:onlySelf});};FormControl.prototype._updateValue=function(){};FormControl.prototype._anyControls=function(condition){return false;};FormControl.prototype._allControlsDisabled=function(){return this.disabled;};FormControl.prototype.registerOnChange=function(fn){this._onChange.push(fn);};FormControl.prototype._clearChangeFns=function(){this._onChange=[];this._onDisabledChange=null;};FormControl.prototype.registerOnDisabledChange=function(fn){this._onDisabledChange=fn;};FormControl.prototype._forEachChild=function(cb){};FormControl.prototype._applyFormState=function(formState){if(this._isBoxedValue(formState)){this._value=formState.value;formState.disabled?this.disable({onlySelf:true,emitEvent:false}):this.enable({onlySelf:true,emitEvent:false});}
else{this._value=formState;}};return FormControl;}(AbstractControl));export var FormGroup=(function(_super){__extends(FormGroup,_super);function FormGroup(controls,validator,asyncValidator){if(validator===void 0){validator=null;}
if(asyncValidator===void 0){asyncValidator=null;}
_super.call(this,validator,asyncValidator);this.controls=controls;this._initObservables();this._setParentForControls();this.updateValueAndValidity({onlySelf:true,emitEvent:false});}
FormGroup.prototype.registerControl=function(name,control){if(this.controls[name])
return this.controls[name];this.controls[name]=control;control.setParent(this);return control;};FormGroup.prototype.addControl=function(name,control){this.registerControl(name,control);this.updateValueAndValidity();};FormGroup.prototype.removeControl=function(name){StringMapWrapper.delete(this.controls,name);this.updateValueAndValidity();};FormGroup.prototype.contains=function(controlName){var c=StringMapWrapper.contains(this.controls,controlName);return c&&this.get(controlName).enabled;};FormGroup.prototype.setValue=function(value,_a){var _this=this;var onlySelf=(_a===void 0?{}:_a).onlySelf;this._checkAllValuesPresent(value);StringMapWrapper.forEach(value,function(newValue,name){_this._throwIfControlMissing(name);_this.controls[name].setValue(newValue,{onlySelf:true});});this.updateValueAndValidity({onlySelf:onlySelf});};FormGroup.prototype.patchValue=function(value,_a){var _this=this;var onlySelf=(_a===void 0?{}:_a).onlySelf;StringMapWrapper.forEach(value,function(newValue,name){if(_this.controls[name]){_this.controls[name].patchValue(newValue,{onlySelf:true});}});this.updateValueAndValidity({onlySelf:onlySelf});};FormGroup.prototype.reset=function(value,_a){if(value===void 0){value={};}
var onlySelf=(_a===void 0?{}:_a).onlySelf;this._forEachChild(function(control,name){control.reset(value[name],{onlySelf:true});});this.updateValueAndValidity({onlySelf:onlySelf});this._updatePristine({onlySelf:onlySelf});this._updateTouched({onlySelf:onlySelf});};FormGroup.prototype.getRawValue=function(){return this._reduceChildren({},function(acc,control,name){acc[name]=control.value;return acc;});};FormGroup.prototype._throwIfControlMissing=function(name){if(!Object.keys(this.controls).length){throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");}
if(!this.controls[name]){throw new Error("Cannot find form control with name: "+name+".");}};FormGroup.prototype._forEachChild=function(cb){StringMapWrapper.forEach(this.controls,cb);};FormGroup.prototype._setParentForControls=function(){var _this=this;this._forEachChild(function(control,name){control.setParent(_this);});};FormGroup.prototype._updateValue=function(){this._value=this._reduceValue();};FormGroup.prototype._anyControls=function(condition){var _this=this;var res=false;this._forEachChild(function(control,name){res=res||(_this.contains(name)&&condition(control));});return res;};FormGroup.prototype._reduceValue=function(){var _this=this;return this._reduceChildren({},function(acc,control,name){if(control.enabled||_this.disabled){acc[name]=control.value;}
return acc;});};FormGroup.prototype._reduceChildren=function(initValue,fn){var res=initValue;this._forEachChild(function(control,name){res=fn(res,control,name);});return res;};FormGroup.prototype._allControlsDisabled=function(){for(var _i=0,_a=Object.keys(this.controls);_i<_a.length;_i++){var controlName=_a[_i];if(this.controls[controlName].enabled){return false;}}
return!StringMapWrapper.isEmpty(this.controls);};FormGroup.prototype._checkAllValuesPresent=function(value){this._forEachChild(function(control,name){if(value[name]===undefined){throw new Error("Must supply a value for form control with name: '"+name+"'.");}});};return FormGroup;}(AbstractControl));export var FormArray=(function(_super){__extends(FormArray,_super);function FormArray(controls,validator,asyncValidator){if(validator===void 0){validator=null;}
if(asyncValidator===void 0){asyncValidator=null;}
_super.call(this,validator,asyncValidator);this.controls=controls;this._initObservables();this._setParentForControls();this.updateValueAndValidity({onlySelf:true,emitEvent:false});}
FormArray.prototype.at=function(index){return this.controls[index];};FormArray.prototype.push=function(control){this.controls.push(control);control.setParent(this);this.updateValueAndValidity();};FormArray.prototype.insert=function(index,control){ListWrapper.insert(this.controls,index,control);control.setParent(this);this.updateValueAndValidity();};FormArray.prototype.removeAt=function(index){ListWrapper.removeAt(this.controls,index);this.updateValueAndValidity();};Object.defineProperty(FormArray.prototype,"length",{get:function(){return this.controls.length;},enumerable:true,configurable:true});FormArray.prototype.setValue=function(value,_a){var _this=this;var onlySelf=(_a===void 0?{}:_a).onlySelf;this._checkAllValuesPresent(value);value.forEach(function(newValue,index){_this._throwIfControlMissing(index);_this.at(index).setValue(newValue,{onlySelf:true});});this.updateValueAndValidity({onlySelf:onlySelf});};FormArray.prototype.patchValue=function(value,_a){var _this=this;var onlySelf=(_a===void 0?{}:_a).onlySelf;value.forEach(function(newValue,index){if(_this.at(index)){_this.at(index).patchValue(newValue,{onlySelf:true});}});this.updateValueAndValidity({onlySelf:onlySelf});};FormArray.prototype.reset=function(value,_a){if(value===void 0){value=[];}
var onlySelf=(_a===void 0?{}:_a).onlySelf;this._forEachChild(function(control,index){control.reset(value[index],{onlySelf:true});});this.updateValueAndValidity({onlySelf:onlySelf});this._updatePristine({onlySelf:onlySelf});this._updateTouched({onlySelf:onlySelf});};FormArray.prototype.getRawValue=function(){return this.controls.map(function(control){return control.value;});};FormArray.prototype._throwIfControlMissing=function(index){if(!this.controls.length){throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");}
if(!this.at(index)){throw new Error("Cannot find form control at index "+index);}};FormArray.prototype._forEachChild=function(cb){this.controls.forEach(function(control,index){cb(control,index);});};FormArray.prototype._updateValue=function(){var _this=this;this._value=this.controls.filter(function(control){return control.enabled||_this.disabled;}).map(function(control){return control.value;});};FormArray.prototype._anyControls=function(condition){return this.controls.some(function(control){return control.enabled&&condition(control);});};FormArray.prototype._setParentForControls=function(){var _this=this;this._forEachChild(function(control){control.setParent(_this);});};FormArray.prototype._checkAllValuesPresent=function(value){this._forEachChild(function(control,i){if(value[i]===undefined){throw new Error("Must supply a value for form control at index: "+i+".");}});};FormArray.prototype._allControlsDisabled=function(){for(var _i=0,_a=this.controls;_i<_a.length;_i++){var control=_a[_i];if(control.enabled)
return false;}
return!!this.controls.length;};return FormArray;}(AbstractControl));