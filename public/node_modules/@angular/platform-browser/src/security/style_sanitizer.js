
import{isDevMode}from'@angular/core';import{getDOM}from'../dom/dom_adapter';import{sanitizeUrl}from'./url_sanitizer';var VALUES='[-,."\'%_!# a-zA-Z0-9]+';var TRANSFORMATION_FNS='(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?';var COLOR_FNS='(?:rgb|hsl)a?';var FN_ARGS='\\([-0-9.%, a-zA-Z]+\\)';var SAFE_STYLE_VALUE=new RegExp("^("+VALUES+"|(?:"+TRANSFORMATION_FNS+"|"+COLOR_FNS+")"+FN_ARGS+")$",'g');var URL_RE=/^url\(([^)]+)\)$/;function hasBalancedQuotes(value){var outsideSingle=true;var outsideDouble=true;for(var i=0;i<value.length;i++){var c=value.charAt(i);if(c==='\''&&outsideDouble){outsideSingle=!outsideSingle;}
else if(c==='"'&&outsideSingle){outsideDouble=!outsideDouble;}}
return outsideSingle&&outsideDouble;}
export function sanitizeStyle(value){value=String(value).trim();if(!value)
return'';var urlMatch=value.match(URL_RE);if((urlMatch&&sanitizeUrl(urlMatch[1])===urlMatch[1])||value.match(SAFE_STYLE_VALUE)&&hasBalancedQuotes(value)){return value;}
if(isDevMode()){getDOM().log("WARNING: sanitizing unsafe style value "+value+" (see http://g.co/ng/security#xss).");}
return'unsafe';}